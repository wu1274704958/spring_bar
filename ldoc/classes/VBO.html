---
layout: default
title: VBO
permalink: ldoc/classes/VBO.html
description: Vertex Buffer Object
parent: Lua API
table: 0x5609a6d70530
---

{% raw %}
    <h1>Class <code>VBO</code></h1>
    <p>Vertex Buffer Object</p>
    <p>

<hr/>
</p>
      <h3>See also:</h3>
      <ul>
          <li><a href="../modules/LuaVBO.html#gl.GetVBO">LuaVBO.GetVBO</a></li>
          <li><a href="https://github.com/beyond-all-reason/spring/blob/BAR105/rts/Lua/LuaVBOImpl.cpp">rts/Lua/LuaVBOImpl.cpp</a></li>
      </ul>

        <h2 class="no_anchor"><a href="#Methods">Methods</a></h2>
        <dl class="big-dt">
            <dt>
              <a href="#VBO:Delete">VBO:Delete</a>
            </dt>
            <dd>



            </dd>
            <dt>
              <a href="#VBO:Define">VBO:Define</a>
            </dt>
            <dd>
              Allows you to specify what kind of VBO you will be using.
            </dd>
            <dt>
              <a href="#VBO:GetBufferSize">VBO:GetBufferSize</a>
            </dt>
            <dd>



            </dd>
            <dt>
              <a href="#VBO:Upload">VBO:Upload</a>
            </dt>
            <dd>
              Uploads the data (array of floats) into the VBO
            </dd>
            <dt>
              <a href="#VBO:Download">VBO:Download</a>
            </dt>
            <dd>



            </dd>
            <dt>
              <a href="#VBO:ModelsVBO">VBO:ModelsVBO</a>
            </dt>
            <dd>
              Binds engine side vertex or index VBO containing models (units, features) data.
            </dd>
            <dt>
              <a href="#VBO:InstanceDataFromUnitDefIDs">VBO:InstanceDataFromUnitDefIDs</a>
            </dt>
            <dd>
              Fills in attribute data for each specified unitDefID
            </dd>
            <dt>
              <a href="#VBO:InstanceDataFromFeatureDefIDs">VBO:InstanceDataFromFeatureDefIDs</a>
            </dt>
            <dd>
              Fills in attribute data for each specified featureDefID
            </dd>
            <dt>
              <a href="#VBO:InstanceDataFromUnitIDs">VBO:InstanceDataFromUnitIDs</a>
            </dt>
            <dd>
              Fills in attribute data for each specified unitID
            </dd>
            <dt>
              <a href="#VBO:InstanceDataFromFeatureIDs">VBO:InstanceDataFromFeatureIDs</a>
            </dt>
            <dd>
              Fills in attribute data for each specified featureID
            </dd>
            <dt>
              <a href="#VBO:MatrixDataFromProjectileIDs">VBO:MatrixDataFromProjectileIDs</a>
            </dt>
            <dd>



            </dd>
            <dt>
              <a href="#VBO:BindBufferRange">VBO:BindBufferRange</a>
            </dt>
            <dd>
              Bind a range within a buffer object to an indexed buffer target
            </dd>
            <dt>
              <a href="#VBO:UnbindBufferRange">VBO:UnbindBufferRange</a>
            </dt>
            <dd>



            </dd>
            <dt>
              <a href="#VBO:DumpDefinition">VBO:DumpDefinition</a>
            </dt>
            <dd>
              Logs the definition of the VBO to the console
            </dd>
        </dl>

      <h2 id="Methods" class="section-header ">
        Methods
      </h2>

        <h3 id="VBO:Delete">
          VBO:Delete()
        </h3>
        <p></p>
        <div class="code-example">
        <p>

        </p>



      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">nil</span></strong>


</li>
          </ol>



        </div>
        <h3 id="VBO:Define">
          VBO:Define(size, attribs)
        </h3>
        <p>Allows you to specify what kind of VBO you will be using.</p>
        <div class="code-example">
        <p>


 It is usually an array of vertex/color/uv data, but can also be an array of
 instance uniforms.

 If you want to specify multiple instances of something to render, you will
 need to create another VBO, which also specifies the number of instances you
 wish to render, and the size of the data passed to each instance.

 If you want say 5 elements, and each element is defined in the layout:

     {id = 0, name = "first", size = 1},{id = 1, name = "second", size = 2}}

 , then the total size of your VBO will be 5 * (1 + 2).

 They will be laid out consecutively: [1,2],[1,2],[1,2],[1,2],[1,2].

 This is important for when you call VBO:Upload, you need to make sure you
 enter your data into the Lua array correctly.

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>size</code>
                   <strong><span class="type">number</span></strong>
                    the maximum number of elements this VBO can have.
                 </li>
                 <li>
                   <code>attribs</code>
                   <strong><span class="type">number</span> or <span class="type">{{number,number,number,number,number},...}</span></strong>



<p> When number, the maximum number of elements this VBO can have.</p>

<p> Otherwise, an array of arrays specifying the layout composed of:</p>

<ul>
    <li><code>id</code>: the location in the vertex shader layout e.g.: layout (location = 0)
    in vec2 aPos. optional attrib, specifies location in the vertex shader.
    If not specified the implementation will increment the counter starting from 0.
    There can be maximum 16 attributes (so id of 15 is max).</li>
    <li><code>name</code>: the name for this VBO, only used for debugging</li>
    <li><code>size</code>: optional, defaults to 4 for VBO. The number of floats that
    constitute 1 element in this buffer. O.g. for the previous layout
    (location = 0) in vec2 aPos, it would be size = 2.</li>
    <li><a href="https://www.lua.org/manual/5.1/manual.html#pdf-type">type</a>: is the datatype of this element, can be: <code>GL.BYTE</code>,
    <code>GL.UNSIGNED_BYTE</code>, <code>GL.SHORT</code>, <code>GL.UNSIGNED_SHORT</code>, <code>GL.INT</code>,
    <code>GL.UNSIGNED_INT</code>, <code>GL.FLOAT</code>. Default is <code>GL.FLOAT</code>.</li>
    <li><code>normalized</code>: it's possible to submit say normal without normalizing them
    first, normalized will make sure data is normalized.
    Optional attrib, defaults to false.</li>
</ul>


                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">nil</span></strong>


</li>
          </ol>


          <h4 class="no_anchor">See also:</h4>
          <ul>
              <li><a href="../modules/GL.html#OpenGL_Data_Types">OpenGL Data Types</a></li>
              <li><a href="../classes/VBO.html#VBO:Upload">VBO:Upload</a></li>
          </ul>

          <h4 class="no_anchor">Usage:</h4>
          <ul>
            <li><pre class="example">terrainVertexVBO:Define(numPoints, { {id = <span class="number">0</span>, name = <span class="string">"pos"</span>, size = <span class="number">2</span>}, })</pre></li>
          </ul>
        </div>
        <h3 id="VBO:GetBufferSize">
          VBO:GetBufferSize()
        </h3>
        <p></p>
        <div class="code-example">
        <p>

        </p>



      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">number</span></strong>
              elementsCount</li>
              <li>
                <strong><span class="type">number</span></strong>
              bufferSizeInBytes</li>
              <li>
                <strong><span class="type">number</span></strong>
              size</li>
          </ol>



        </div>
        <h3 id="VBO:Upload">
          VBO:Upload(vboData[, attributeIndex=-1[, elemOffset=0[, luaStartIndex=0[, luaFinishIndex]]]])
        </h3>
        <p>Uploads the data (array of floats) into the VBO</p>
        <div class="code-example">
        <p>

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>vboData</code>
                   <strong><span class="type">{number,...}</span></strong>
                    a lua array of values to upload into the
 VBO
                 </li>
                 <li>
                   <code>attributeIndex</code>
                   <strong><span class="type">number</span></strong>
                    If supplied with non-default value then the
 data from vboData will only be used to upload the data to this particular
 attribute.
 The whole vboData is expected to contain only attributeIndex data.
 Otherwise all attributes get updated sequentially across attributes and elements.
                   (<em>default</em> -1)
                 </li>
                 <li>
                   <code>elemOffset</code>
                   <strong><span class="type">number</span></strong>
                    which VBO element to start uploading data from Lua array into
                   (<em>default</em> 0)
                 </li>
                 <li>
                   <code>luaStartIndex</code>
                   <strong><span class="type">number</span></strong>
                    start uploading from that element in supplied Lua array
                   (<em>default</em> 0)
                 </li>
                 <li>
                   <code>luaFinishIndex</code>
                   <strong><span class="type">number</span></strong>
                    consider this element the last element in Lua array
                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{number,</span></strong>
              ...} indexData</li>
              <li>
                <strong><span class="type">number</span></strong>
              elemOffset</li>
              <li>
                <strong><span class="type">number</span> or <span class="type">{number,number,number,number}</span></strong>
              attrID</li>
          </ol>


          <h4 class="no_anchor">See also:</h4>
          <ul>
              <li><a href="../classes/VBO.html#VBO:Define">VBO:Define</a></li>
          </ul>

          <h4 class="no_anchor">Usage:</h4>
          <ul>
            <li><pre class="example">vbo:Upload(posArray, <span class="number">0</span>, <span class="number">1</span>)
<span class="comment">-- 0 is offset into vbo (on GPU) in this case no offset
</span><span class="comment">-- 1 is lua index index into the Lua table, in this case it's same as default
</span><span class="comment">-- Upload will upload from luaOffset to end of lua array</span></pre></li>
            <li><pre class="example">rectInstanceVBO:Upload({<span class="number">1</span>},<span class="number">0</span>)</pre></li>
          </ul>
        </div>
        <h3 id="VBO:Download">
          VBO:Download([attributeIndex=-1[, elementOffset=0[, elementCount[, forceGPURead=false]]]])
        </h3>
        <p></p>
        <div class="code-example">
        <p>

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>attributeIndex</code>
                   <strong><span class="type">number</span></strong>
                    when supplied with non-default value: only data
 from specified attribute will be downloaded - otherwise all attributes are
 downloaded
                   (<em>default</em> -1)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>
                    download data starting from this element
                   (<em>default</em> 0)
                 </li>
                 <li>
                   <code>elementCount</code>
                   <strong><span class="type">number</span></strong>
                    number of elements to download
                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>forceGPURead</code>
                   <strong><span class="type">bool</span></strong>
                    force downloading the data from GPU buffer as opposed
 to using shadow RAM buffer
                   (<em>default</em> false)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{{number,...},...}</span></strong>
              vboData</li>
          </ol>



        </div>
        <h3 id="VBO:ModelsVBO">
          VBO:ModelsVBO()
        </h3>
        <p>Binds engine side vertex or index VBO containing models (units, features) data.</p>
        <div class="code-example">
        <p>


 Also fills in VBO definition data as they're set for engine models (no need to do VBO:Define()).

        </p>



      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">nil</span> or <span class="type">number</span></strong>
              buffer size in bytes</li>
          </ol>



        </div>
        <h3 id="VBO:InstanceDataFromUnitDefIDs">
          VBO:InstanceDataFromUnitDefIDs(unitDefIDs, attrID[, teamIdOpt[, elementOffset]])
        </h3>
        <p>Fills in attribute data for each specified unitDefID</p>
        <div class="code-example">
        <p>


 The instance data in that attribute will contain the offset to bind position
 matrix in global matrices SSBO and offset to uniform buffer structure in
 global per unit/feature uniform SSBO (unused for Unit/FeatureDefs), as
 well as some auxiliary data ushc as draw flags and team index.

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>unitDefIDs</code>
                   <strong><span class="type">number</span> or <span class="type">{number,...}</span></strong>



                 </li>
                 <li>
                   <code>attrID</code>
                   <strong><span class="type">number</span></strong>



                 </li>
                 <li>
                   <code>teamIdOpt</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{number,number,number,number}</span></strong>
              instanceData</li>
              <li>
                <strong><span class="type">number</span></strong>
              elementOffset</li>
              <li>
                <strong><span class="type">attrID</span></strong>


</li>
          </ol>



          <h4 class="no_anchor">Usage:</h4>
          <ul>
            <li><pre class="example">Data Layout

SInstanceData:
   , matOffset{ matOffset_ }            // updated during the following draw frames
   , uniOffset{ uniOffset_ }            // updated during the following draw frames
   , info{ teamIndex, drawFlags, <span class="number">0</span>, <span class="number">0</span> } // <span class="keyword">not</span> updated during the following draw frames
   , aux1 { <span class="number">0</span>u }</pre></li>
          </ul>
        </div>
        <h3 id="VBO:InstanceDataFromFeatureDefIDs">
          VBO:InstanceDataFromFeatureDefIDs(featureDefIDs, attrID[, teamIdOpt[, elementOffset]])
        </h3>
        <p>Fills in attribute data for each specified featureDefID</p>
        <div class="code-example">
        <p>


 The instance data in that attribute will contain the offset to bind position
 matrix in global matrices SSBO and offset to uniform buffer structure in
 global per unit/feature uniform SSBO (unused for Unit/FeatureDefs), as
 well as some auxiliary data ushc as draw flags and team index.

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>featureDefIDs</code>
                   <strong><span class="type">number</span> or <span class="type">{number,...}</span></strong>



                 </li>
                 <li>
                   <code>attrID</code>
                   <strong><span class="type">number</span></strong>



                 </li>
                 <li>
                   <code>teamIdOpt</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{number,number,number,number}</span></strong>
              instanceData</li>
              <li>
                <strong><span class="type">number</span></strong>
              elementOffset</li>
              <li>
                <strong><span class="type">attrID</span></strong>


</li>
          </ol>



          <h4 class="no_anchor">Usage:</h4>
          <ul>
            <li><pre class="example">Data Layout

SInstanceData:
   , matOffset{ matOffset_ }            // updated during the following draw frames
   , uniOffset{ uniOffset_ }            // updated during the following draw frames
   , info{ teamIndex, drawFlags, <span class="number">0</span>, <span class="number">0</span> } // <span class="keyword">not</span> updated during the following draw frames
   , aux1 { <span class="number">0</span>u }</pre></li>
          </ul>
        </div>
        <h3 id="VBO:InstanceDataFromUnitIDs">
          VBO:InstanceDataFromUnitIDs(unitIDs, attrID[, teamIdOpt[, elementOffset]])
        </h3>
        <p>Fills in attribute data for each specified unitID</p>
        <div class="code-example">
        <p>


 The instance data in that attribute will contain the offset to bind position
 matrix in global matrices SSBO and offset to uniform buffer structure in
 global per unit/feature uniform SSBO (unused for Unit/FeatureDefs), as
 well as some auxiliary data ushc as draw flags and team index.

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>unitIDs</code>
                   <strong><span class="type">number</span> or <span class="type">{number,...}</span></strong>



                 </li>
                 <li>
                   <code>attrID</code>
                   <strong><span class="type">number</span></strong>



                 </li>
                 <li>
                   <code>teamIdOpt</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{number,number,number,number}</span></strong>
              instanceData</li>
              <li>
                <strong><span class="type">number</span></strong>
              elementOffset</li>
              <li>
                <strong><span class="type">attrID</span></strong>


</li>
          </ol>



          <h4 class="no_anchor">Usage:</h4>
          <ul>
            <li><pre class="example">Data Layout

SInstanceData:
   , matOffset{ matOffset_ }            // updated during the following draw frames
   , uniOffset{ uniOffset_ }            // updated during the following draw frames
   , info{ teamIndex, drawFlags, <span class="number">0</span>, <span class="number">0</span> } // <span class="keyword">not</span> updated during the following draw frames
   , aux1 { <span class="number">0</span>u }</pre></li>
          </ul>
        </div>
        <h3 id="VBO:InstanceDataFromFeatureIDs">
          VBO:InstanceDataFromFeatureIDs(featureIDs, attrID[, teamIdOpt[, elementOffset]])
        </h3>
        <p>Fills in attribute data for each specified featureID</p>
        <div class="code-example">
        <p>


 The instance data in that attribute will contain the offset to bind position
 matrix in global matrices SSBO and offset to uniform buffer structure in
 global per unit/feature uniform SSBO (unused for Unit/FeatureDefs), as
 well as some auxiliary data ushc as draw flags and team index.

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>featureIDs</code>
                   <strong><span class="type">number</span> or <span class="type">{number,...}</span></strong>



                 </li>
                 <li>
                   <code>attrID</code>
                   <strong><span class="type">number</span></strong>



                 </li>
                 <li>
                   <code>teamIdOpt</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{number,number,number,number}</span></strong>
              instanceData</li>
              <li>
                <strong><span class="type">number</span></strong>
              elementOffset</li>
              <li>
                <strong><span class="type">attrID</span></strong>


</li>
          </ol>



        </div>
        <h3 id="VBO:MatrixDataFromProjectileIDs">
          VBO:MatrixDataFromProjectileIDs(projectileIDs, attrID[, teamIdOpt[, elementOffset]])
        </h3>
        <p></p>
        <div class="code-example">
        <p>

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>projectileIDs</code>
                   <strong><span class="type">number</span> or <span class="type">{number,...}</span></strong>



                 </li>
                 <li>
                   <code>attrID</code>
                   <strong><span class="type">number</span></strong>



                 </li>
                 <li>
                   <code>teamIdOpt</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">{number,</span></strong>
              ...} matDataVec 4x4 matrix</li>
              <li>
                <strong><span class="type">number</span></strong>
              elemOffset</li>
              <li>
                <strong><span class="type">number</span> or <span class="type">{number,number,number,number}</span></strong>
              attrID</li>
          </ol>



        </div>
        <h3 id="VBO:BindBufferRange">
          VBO:BindBufferRange(index[, elementOffset[, elementCount[, target]]])
        </h3>
        <p>Bind a range within a buffer object to an indexed buffer target</p>
        <div class="code-example">
        <p>


 Generally mimics
 https://registry.khronos.org/OpenGL-Refpages/gl4/html/glBindBufferRange.xhtml
 except offset and size are specified in number of elements / element indices.

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>index</code>
                   <strong><span class="type">number</span></strong>
                    should be in the range between
 <code>5 &lt; index &lt; GL_MAX_UNIFORM_BUFFER_BINDINGS</code> value (usually 31)
                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementCount</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>target</code>
                   <strong><span class="type">number</span></strong>
                    glEnum
                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">number</span></strong>
              bindingIndex when successful, -1 otherwise</li>
          </ol>



        </div>
        <h3 id="VBO:UnbindBufferRange">
          VBO:UnbindBufferRange(index[, elementOffset[, elementCount[, target]]])
        </h3>
        <p></p>
        <div class="code-example">
        <p>

        </p>


           <h4 class="no_anchor">Parameters:</h4>
           <ol>
                 <li>
                   <code>index</code>
                   <strong><span class="type">number</span></strong>



                 </li>
                 <li>
                   <code>elementOffset</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>elementCount</code>
                   <strong><span class="type">number</span></strong>



                   (<em>optional</em>)
                 </li>
                 <li>
                   <code>target</code>
                   <strong><span class="type">number</span></strong>
                    glEnum
                   (<em>optional</em>)
                 </li>
           </ol>

      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">number</span></strong>
              bindingIndex when successful, -1 otherwise</li>
          </ol>



        </div>
        <h3 id="VBO:DumpDefinition">
          VBO:DumpDefinition()
        </h3>
        <p>Logs the definition of the VBO to the console</p>
        <div class="code-example">
        <p>

        </p>



      <h4 class="no_anchor">Returns:</h4>
          <ol>
              <li>
                <strong><span class="type">nil</span></strong>


</li>
          </ol>



        </div>

{% endraw %}
